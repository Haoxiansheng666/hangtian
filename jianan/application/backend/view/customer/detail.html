{include file="public/header" /}<style type="text/css"> html{    background-color:#fff;  }  .layui-tab-brief{    margin:30px 50px;  }  .layui-timeline{    margin-top:30PX; ;   }  .center-margin-top{    margin-top: 30px;    text-align: center;  }  .padding-bottom_60{    padding-bottom: 60px;  }</style><!--<blockquote class="layui-elem-quote" style="margin-top:36px;margin-left: 30px;">{$data['ress']->name}<a class="layui-btn  layui-btn-sm layui-btn-warm" href="{:url('Customer/index')}"   style="float:right;"><i class="layui-icon">&#xe65c;</i>返回列表</a></blockquote>--><div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">  <ul class="layui-tab-title">    <li class="layui-this">客户详情</li>    <li>回访记录</li>  </ul>  <div class="layui-tab-content " style="height: 100px;">    <div class="layui-tab-item layui-show">      <form class="layui-form" style="margin-top:20px;">      <div class="layui-form-item">        <label class="layui-form-label">客户称呼<span class="reqcolor"></span></label>        <div class="layui-input-block">          <input type="text" name="name"  class="layui-input" lay-verify="required" value="{$data['ress']['name']?$data['ress']['name']:''}" disabled>        </div>      </div>      <div class="layui-form-item">        <label class="layui-form-label">客户电话</label>        <div class="layui-input-block">          <input type="text" name="mobile"  class="layui-input" value="{$data['ress']['mobile']?$data['ress']['mobile']:''}" disabled>        </div>      </div>          <div class="layui-form-item" {if $data.ress.mobile1}style="display:black"{else}style="display:none"{/if}>              <label class="layui-form-label">备用电话1</label>              <div class="layui-input-block">                  <input type="text" name="mobile1"  class="layui-input" value="{$data['ress']['mobile1']?$data['ress']['mobile1']:''}" disabled>              </div>          </div>          <div class="layui-form-item" {if $data.ress.mobile2}style="display:black"{else}style="display:none"{/if}>              <label class="layui-form-label">备用电话2</label>              <div class="layui-input-block">                  <input type="text" name="mobile2"  class="layui-input" value="{$data['ress']['mobile2']?$data['ress']['mobile2']:''}" disabled>              </div>          </div>          <div class="layui-form-item">              <!--        <label class="layui-form-label">工种</label>-->              <label class="layui-form-label">工种分类</label>              <div class="layui-input-block">                  {if !empty($data.ress.profession_info)}                  <div class="layui-input-inline">                      <input type="text" name="name"  class="layui-input" lay-verify="required" value="{$data['ress']['profession_cate_info']['name']|default=''}" disabled>                  </div>                  <label class="layui-form-label">二级栏目</label>                  <div class="layui-input-inline">                      <input type="text" name="name"  class="layui-input" lay-verify="required" value="{$data['ress']['profession_top_info']['name']|default=''}" disabled>                  </div>                  <label class="layui-form-label">工种选择</label>                  <div class="layui-input-inline">                      <input type="text" name="name"  class="layui-input" lay-verify="required" value="{$data['ress']['profession_info']['name']|default=''}" disabled>                  </div>                  {else}                  <input type="text"  name="warn_time"  class="layui-input" value="未选择工种" disabled>                  {/if}              </div>          </div>      {if($data['ress']->from == 2)}      <div class="layui-form-item">        <label class="layui-form-label">详细地址</label>        <div class="layui-input-block">          <input type="text" name="address"  class="layui-input" value="{$data['ress']['address']?$data['ress']['address']:''}" disabled>        </div>      </div>      {/if}      <div class="layui-form-item">          <label class="layui-form-label">客户分类<span style="color:red;"></span></label>          <div class="layui-input-block">            <input type="text"   class="layui-input" id="time1" placeholder="  请选择" value="{$data['ress']->from_text|default=''}" disabled>          </div>      </div>      <div class="layui-form-item">          <label class="layui-form-label">客户等级<span style="color:red;"></span></label>          <div class="layui-input-block">              <input type="text"   class="layui-input" id="cate" placeholder="  请选择" value="{$data['ress']['cate']['name']}" disabled>          </div>      </div>      <div class="layui-form-item">          <label class="layui-form-label">客户来源<span style="color:red;"></span></label>          <div class="layui-input-block">              <input type="text"   class="layui-input" id="customer_source_name" placeholder="  请选择" value="{$data['ress']->customer_source_name|default = ''}" disabled>          </div>      </div>      {if $data['ress']->from == 2}      <div class="layui-form-item">          <label class="layui-form-label">企业名称</label>          <div class="layui-input-block">              <input type="text" class="layui-input" value="{$data['ress']['company']|default=''}" disabled>          </div>      </div>      {/if}      <div class="layui-form-item">        <label class="layui-form-label">添加部门</label>        <div class="layui-input-block">          <input type="text"  name="warn_time"  class="layui-input" id="time1"  value="{$data['ress']->hasGroupone->group_name?$data['ress']->hasGroupone->group_name:''}" disabled>        </div>      </div>      <div class="layui-form-item">        <label class="layui-form-label">添加员工</label>        <div class="layui-input-block">          <input type="text" class="layui-input" value="{$data['ress']->hasAuone->real_name?$data['ress']->hasAuone->real_name:''}" disabled>        </div>      </div>          <div class="layui-form-item">              <label class="layui-form-label">录入时间</label>              <div class="layui-input-block">                  <input type="text" class="layui-input" value="{$data['ress']->create_time?$data['ress']->create_time:''}" disabled>              </div>          </div>          <div class="layui-form-item">              <label class="layui-form-label">最后联系时间</label>              <div class="layui-input-block">                  <input type="text" class="layui-input" value="{$data['ress']->end_time?$data['ress']->end_time:''}" disabled>              </div>          </div>        <div class="layui-form-item center-margin-top">          <button type="button" class="layui-btn" title="放弃该客户" onclick="abandon()"> 放弃该客户 </button>          <button type="button" class="layui-btn" title="转让该客户" onclick="make_over()"> 转让该客户 </button>        </div>      </form>    </div>    <div class="layui-tab-item">        {if !empty($data.record)}      <ul class="layui-timeline">        <?php  if(isset($data['record'])){  ?>        {foreach $data['record'] as $k=> $v}        <li class="layui-timeline-item">          <i class="layui-icon layui-timeline-axis"></i>          <div class="layui-timeline-content layui-text">            <h3 class="layui-timeline-title">{$v->create_time}</h3>            {$v->contents}            <ul>              <li>{$v->hasauone->real_name}</li>            </ul>          </div>        </li>        {/foreach}        <?php  } ?>        <li class="layui-timeline-item">          <i class="layui-icon layui-timeline-axis"></i>          <div class="layui-timeline-content layui-text">            <div class="layui-timeline-title">START</div>          </div>        </li>      </ul>        {else}        暂无回访记录        {/if}      <div class="layui-form-item center-margin-top padding-bottom_60">        <button type="button" class="layui-btn" title="立即报名" onclick="pay()"> 立即报名 </button>      </div>    </div>  </div></div><script type="text/javascript">  // 立即报名  function pay() {      var id = "{$data.ress.id}";      var url = "{:Url('Customer/pay')}" + '?id=' + id;      x_admin_show('报名缴费',url,1100,800);  }  // 放弃该客户  function abandon() {    layer.open( {      content:"确认是否放弃该客户",      btn: ['确认','再想想'] //按钮      ,yes: function () {        console.log(12);        var data = {id: "{$data['ress']['id']}"};        var url = "{:Url('Customer/abandon')}";        jqueryAjax('POST',url,data,function(res){          if( res.code == 1 ){            layer.msg(res.msg,{icon: 1,time:1500},function () {              location.href = "{:url('Customer/index')}";            });          }else{            layer.msg(res.msg,{icon: 2,time:2000});          }        });      },btn2: function(){        layer.closeAll();      }    });    return false;  }  // 转让该客户  function make_over() {    let url = "{:url('Customer/make_over')}";    let data = {};    layer.open({      title:"选择接收人",      type: 1,      skin: 'layui-layer-rim', //加上边框      area: ['60%', '60%'], //宽高      content: $("#select_admin"),      btn:['确定'],      yes:function () {        let v = $("#selectauid option:selected").val();        if (v == ''){            layer.msg('请选择部门人员');        }        let transfer_cause = $('#transfer_cause').val();        data = {id:"{$data['ress']['id']}",auid:v,transfer_cause:transfer_cause};        jqueryAjax('POST',url,data,function(res){          if( res.code == 1 ){            layer.msg(res.msg,{icon: 1,time:2000},function () {              location.href = "{:url('Customer/index')}";            });          }else{            layer.msg(res.msg,{icon: 2,time:2000});          }        });      }    });  }</script>{include file="public/footer" /}<style>    .make_div{        margin: 20px 0;    }    .make_text{        width: 70%;    }    .make_title{        float: left;        line-height: 38px;        width: 75px;    }    .make_select{        width: 70%;        border-color: #E6E6E6;    }</style><div id="select_admin" style="display: none ;margin: 10px 0 0 50px" >    <div class="make_div">        <div class="make_title">校区</div>        <select class="make_select layui-select" name='admin_school' onchange="school()" lay-search='' id='selectschool' style="width: 70%"></select>    </div>    <div class="make_div">        <div class="make_title">部门</div>        <select class="make_select layui-select" name='admin_group' onchange="admin()" lay-search='' id='selectgroup' style="width: 70%"></select>    </div>    <div class="make_div">        <div class="make_title">部门人员</div>        <select class="make_select layui-select" name='auid' lay-search='' id='selectauid' style="width: 70%"></select>    </div>    <div class="make_div">        <div class="make_title">转让原因</div>        <textarea id="transfer_cause" rows="10" class="make_text" name="transfer_cause"></textarea>    </div>  <script>    layui.use(['table', 'form'], function(){      var form = layui.form        ,school_id = '';      $.ajax({        url:"{:url('AdminUsers/make_over_school')}",        dataType:"JSON",        method:"POST",        success:function (res) {          let data = res.data          let t = '';          for (let i=0;i<data.length;i++){              if (i == 0){                  school_id = data[i]['id'];              }            t += "<option value='"+data[i]['id']+"'> "+ data[i]['name'] + "</option>";          }          $("#selectschool").append(t);            school(school_id)        }      });    });    function school(school_id = ''){        if (school_id == ''){            school_id = $("#selectschool option:selected").val();        }        var department_id = '';        $.ajax({            url:"{:url('AdminUsers/make_over_department')}",            dataType:"JSON",            method:"POST",            data:{school_id:school_id},            success:function (res) {                $("#selectgroup").empty();                let data = res.data                let t = '';                for (let i=0;i<data.length;i++){                    if (i == 0){                        department_id = data[i]['id'];                    }                    t += "<option value='"+data[i]['id']+"'> "+ data[i]['name'] + "</option>";                }                $("#selectgroup").append(t);                admin(department_id)            }        });    }    function admin(department_id = ''){        if (department_id == ''){            department_id = $("#selectgroup option:selected").val() ;        }        if(department_id){            $.ajax({                url:"{:url('AdminUsers/make_over_admin')}",                data:{department_id:department_id},                dataType:"JSON",                method:"POST",                success:function (res) {                    $("#selectauid").empty();                    let data = res.data                    let t = '';                    for (let i=0;i<data.length;i++){                        t += "<option value='"+data[i]['id']+"'> "+ data[i]['real_name'] + "</option>";                    }                    $("#selectauid").append(t);                }            });        }else{            $("#selectauid").empty();        }    }  </script></div>