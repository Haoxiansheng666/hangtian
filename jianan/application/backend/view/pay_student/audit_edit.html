{include file="public/header" /}<script src="__STATICBACKEND__/jscolor/jscolor.js"></script><style type="text/css">  html{    background-color:#fff;  }</style><form class="layui-form"  style="margin-top:30px;width:90%;" id="addform" onkeydown="if(event.keyCode==13){return false;}">    <div class="layui-form-item">        <label class="layui-form-label">客户类型<span class="reqcolor">*</span></label>        <div class="layui-input-block">            <input type="radio" name="apply_type" value="1" {if !empty($data.apply_type) && $data.apply_type eq '1' || empty($data.apply_type)} checked {/if} title="普通培训"><!--            <input type="radio" name="apply_type" value="2" {if !empty($data.apply_type) && $data.apply_type eq '2'} checked {/if}  title="职业提升">-->        </div>    </div>    {if !empty($data.admin.id)}    <input type="hidden" name="auid" value="{$data.admin.id}">    <input type="hidden" name="group_id" value="{$data.admin.group_id}">    {else}    <div class="layui-form-item">        <label class="layui-form-label">添加人<span class="reqcolor">*</span></label>        <div class="layui-input-block">            <select name="auid" id="auid">                {foreach $admin as $k => $v}                <option value="{$v.id}">{$v.real_name}</option>                {/foreach}            </select>        </div>    </div>    {/if}    <div class="layui-form-item">        <label class="layui-form-label">客户姓名</label>        <div class="layui-input-block">            <input type="text" class="layui-input" name="name" value="{$data.name|default=''}" {if !empty($data.name)} readonly {/if}>        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label">手机号</label>        <div class="layui-input-block">            <input type="text" class="layui-input" name="mobile" value="{$data.mobile|default=''}" {if !empty($data.mobile)} readonly {/if}>        </div>    </div>    {if !empty($data.customer_id)}    <input type="hidden" name="customer_id" value="{$data.customer_id}">    {/if}    <div class="layui-form-item">        <label class="layui-form-label">身份证号</label>        <div class="layui-input-block">            <input type="text" class="layui-input" name="id_card" value="{$data.id_card|default=''}" {if !empty($data.id_card)} readonly {/if}>        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label">客户分类<span class="reqcolor">*</span></label>        <div class="layui-input-block">            <input type="radio" name="from" value="1" {if !empty($data.from) && $data.from eq '1' || empty($data.from)} checked {/if} title="个人">            <!--<input type="radio" name="from" value="2" {if !empty($data.from) && $data.from eq '2'} checked {/if}  title="企业">-->        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label">单位名称</label>        <div class="layui-input-block">            <input type="text" class="layui-input" name="company" value="{$data.company|default=''}">        </div>    </div>    <div class="layui-form-item"><!--        <label class="layui-form-label">工种</label>-->        <label class="layui-form-label">工种分类</label>        <div class="layui-input-block">            <div class="layui-input-inline">                <select name="cate_id" id="cate_id" lay-filter="cate_id">                    <option value="">请选择工种分类</option>                    {foreach $pro_cate_list as $k => $v}                    <option value="{$v.id}" <?php if($data['cate_id'] == $v['id']) { ?> selected <?php }?>>{$v.name}</option>                    {/foreach}                </select>            </div>            <label class="layui-form-label">二级栏目</label>            <div class="layui-input-inline">                <select name="profession_top_id" id="pid" lay-filter="pid">                    <option value="0">请选择二级栏目</option>                </select>            </div>            <label class="layui-form-label">工种选择</label>            <div class="layui-input-inline">                <select name="profession_id" id="profession_id">                    <option value="0">请选择工种</option>                </select>            </div>        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label">报名资料</label>        <div class="layui-input-block" id="profession_fields">        </div>    </div><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">报名费用</label>--><!--        <div class="layui-input-block">--><!--            <input type="text" class="layui-input" name="total_price" value="{$data.total_price|default=''}" id="total_price">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">付费类型<span class="reqcolor">*</span></label>--><!--        <div class="layui-input-block">--><!--            <input type="radio" name="pay_type" value="1" {if !empty($data.pay_type) && $data.pay_type eq '1' || empty($data.pay_type)} checked {/if} title="定金">--><!--            <input type="radio" name="pay_type" value="2" {if !empty($data.pay_type) && $data.pay_type eq '2'} checked {/if}  title="全款">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">缴费金额</label>--><!--        <div class="layui-input-block">--><!--            <input type="text" class="layui-input" name="pay_price" value="{$data.pay_price|default=''}">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">付费方式<span class="reqcolor">*</span></label>--><!--        <div class="layui-input-block">--><!--            <input type="radio" name="pay_way" value="1" {if !empty($data.pay_way) && $data.pay_way eq '1' || empty($data.pay_way)} checked {/if} title="对公">--><!--            <input type="radio" name="pay_way" value="2" {if !empty($data.pay_way) && $data.pay_way eq '2'} checked {/if}  title="对私">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">付费渠道<span class="reqcolor">*</span></label>--><!--        <div class="layui-input-block">--><!--            <input type="radio" name="pay_site" value="1" {if !empty($data.pay_site) && $data.pay_site eq '1' || empty($data.pay_site)} checked {/if} title="线上">--><!--            <input type="radio" name="pay_site" value="2" {if !empty($data.pay_site) && $data.pay_site eq '2'} checked {/if}  title="线下">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">支付方式<span class="reqcolor">*</span></label>--><!--        <div class="layui-input-block">--><!--            <select name="proceeds_type" id="proceeds_type">--><!--                {foreach $proceeds_type as $k => $v}--><!--                <option value="{$v.title}">{$v.title}</option>--><!--                {/foreach}--><!--            </select>--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">支付时间</label>--><!--        <div class="layui-input-block">--><!--            <input type="text" class="layui-input" id="pay_time" name="pay_time" value="{$data.pay_time|default=''}">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">培训时间</label>--><!--        <div class="layui-input-block">--><!--            <input type="text" class="layui-input" id="action_train_time" name="action_train_time" value="{$data.action_train_time|default=''}">--><!--        </div>--><!--    </div>--><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">复审时间</label>--><!--        <div class="layui-input-block">--><!--            <input type="text" class="layui-input" id="recheck_time" name="recheck_time" value="{$data.recheck_time|default=''}">--><!--        </div>--><!--    </div>-->    <div class="layui-form-item">        <label class="layui-form-label">推荐就业</label>        <div class="layui-input-block">            <input type="radio" name="recommend_job" value="1" {if !empty($data.recommend_job) && $data.recommend_job eq '1' || empty($data.recommend_job)} checked {/if} title="是">            <input type="radio" name="recommend_job" value="0" {if !empty($data.recommend_job) && $data.recommend_job eq '0'} checked {/if}  title="否">        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label">备注</label>        <div class="layui-input-block">            <textarea class="layui-textarea" name="remark" id="remark">{$data.remark|default=''}</textarea>        </div>    </div><!--    <div class="layui-form-item">--><!--        <label class="layui-form-label">支付凭证</label>--><!--        <div class="layui-input-block layui-upload">--><!--            <button type="button" class="layui-btn" id="pay_proof">上传图片</button>--><!--            <div class="layui-upload-list">--><!--                <img class="layui-upload-img" style="width:25%;border:none;" id="preview" src="{$data.pay_proof|default=''}">--><!--            </div>--><!--            <input type="hidden" name="pay_proof" value="{$data.pay_proof|default=''}">--><!--        </div>--><!--    </div>-->    <div class="layui-form-item" style="text-align:center;">      <div class="layui-input-block">        <input type="hidden" name='customer_id' value="{$data['customer_id']?$data['customer_id']:''}" id='hidden-customer_id'>          <input type="hidden" name='id' value="{$data['id']|default=''}" id='hidden-id'>        <button type="reset" class="layui-btn layui-btn-primary">重置</button>        <button class="layui-btn" lay-submit="" lay-filter="addaction">保 存</button>      </div>    </div></form><script>layui.config({    base: '__STATICBACKEND__/layuiadmin/' //静态资源所在路径  }).extend({    index: 'lib/index' //主入口模块  }).use(['index', 'form', 'laydate', 'upload'], function(){    var $ = layui.$    ,layer = layui.layer    ,laydate = layui.laydate    ,upload = layui.upload    ,form = layui.form;    //执行一个laydate实例    laydate.render({        elem: '#action_train_time' //指定元素    });    laydate.render({        elem: '#recheck_time' //指定元素    });    laydate.render({        elem: '#pay_time' //指定元素    });    //执行实例    var uploadInst = upload.render({        elem: '#pay_proof' //绑定元素        , field: 'img'        ,url: "{:url('upload/layuiImgUpload')}" //上传接口        , before: function (obj) {            //预读本地文件示例，不支持ie8            obj.preview(function (index, file, result) {                $('#preview').attr('src', result); //图片链接（base64）            });        }        ,done: function(res){            //如果上传失败            if (res.code > 0) {                return layer.msg('上传失败');            } else {                var path = res.data;                $('input[name="pay_proof"]').attr('value', path);            }        }        ,error: function(){            //请求异常回调            $('#preview').attr('src', '')            layer.alert('主图大小不能超过300k，请重新选择!');        }    });    /* 监听提交 */    form.on('submit(addaction)', function(data){      var url = "{:url('PayStudent/audit_edit')}";      var data =$("#addform").serializeArray();      jqueryAjax('POST',url,data,successLayui);      return false;    });    var cate_id = "{$data.cate_id|default=''}";    var data_pid = "{$data.pid|default=''}";    if (cate_id){        getSelectData({cate_id:cate_id});    }    if (data_pid){        getSelectSonData({cate_id:data_pid});    }    // 工种一级栏目    form.on('select(cate_id)', function(data){        getSelectData({cate_id:data.value});    });    // 工种列表    form.on('select(pid)', function(data){        getSelectSonData({cate_id:data.value});    });    /**     * 获取一级栏目及下级工种     * @param data     */    function getSelectData(data) {        var pid;        $.ajax({            type:"POST",            url:"{:url('Profession/selectData')}",            data: data,            dataType:"json",            success:function(res){                if (res.code == 1){                    let list = res.data;                    $("#pid").empty();                    var t;                    for (let i=0; i < list.length; i++){                        if (i == 0){                            pid = list[i]['id'];                        }                        if(data_pid){                            pid = data_pid;                            t += `<option `;                            if (data_pid == list[i]['id']){                                t += `selected=true `;                            }                            t += `value="`+list[i]['id']+`">`+list[i]['name']+`</option>`;                        }else{                            t += `<option value="`+list[i]['id']+`">`+list[i]['name']+`</option>`;                        }                    }                    if (pid){                        $.ajax({                            type:"POST",                            url:"{:url('Profession/selectSonData')}",                            data: {cate_id : pid},                            dataType:"json",                            success:function(res){                                if (res.code == 1){                                    let list = res.data;                                    $("#profession_id").empty();                                    $("#profession_fields").empty();                                    var t;                                    let profession_id = "{$data.profession_id|default=''}";                                    for (let i=0; i < list.length; i++){                                        if (i == 0){                                            getPrice(list[i]['id'])                                            getFields(list[i]['id'])                                        }                                        t += `<option `;                                        if (profession_id == list[i]['id']){                                            t += `selected=true `;                                        }                                        t += `value="`+list[i]['id']+`">`+list[i]['name']+`</option>`;                                    }                                    $("#profession_id").append(t);                                    // 添加完记得render下  否则不会刷新到页面中                                    form.render('select');                                }else{                                    $("#profession_id").empty();                                }                            },                            error:function(res){                                $("#profession_id").empty();                                return false;                            }                        });                    }                    $("#pid").append(t);                    // 添加完记得render下  否则不会刷新到页面中                    form.render('select');                }else{                    $("#pid").empty();                }            },            error:function(res){                $("#pid").empty();                return false;            }        });    }    /**     * 获取下级工种     * @param data     */    function getSelectSonData(data) {        console.log(data)        $.ajax({            type:"POST",            url:"{:url('Profession/selectSonData')}",            data: data,            dataType:"json",            success:function(res){                if (res.code == 1){                    let list = res.data;                    $("#profession_id").empty();                    $("#profession_fields").empty();                    var t;                    let profession_id = "{$data.profession_id|default=''}";                    for (let i=0; i < list.length; i++){                        if (i == 0 && profession_id != ''){                            getPrice(list[i]['id'])                            getFields(list[i]['id'])                        }                        t += `<option `;                        if (profession_id == list[i]['id']){                            t += `selected=true `;                        }                        t += `value="`+list[i]['id']+`">`+list[i]['name']+`</option>`;                    }                    $("#profession_id").append(t);                    // 添加完记得render下  否则不会刷新到页面中                    form.render('select');                }else{                    $("#profession_id").empty();                    $("#profession_fields").empty();                }            },            error:function(res){                $("#profession_id").empty();                $("#profession_fields").empty();                return false;            }        });    }    /**     * 获取工种价格     * @param profession_id     */    function getPrice(profession_id) {        $.ajax({            type:"POST",            url:"{:url('Profession/getPrice')}",            data: {profession_id : profession_id},            dataType:"json",            success:function(res){                if (res.code == 1){                    let list = res.data;                    $("#total_price").empty();                    $("#total_price").val(list.price);                    // 添加完记得render下  否则不会刷新到页面中                }else{                    $("#total_price").empty();                }            },            error:function(res){                $("#total_price").empty();                return false;            }        });    }    /**     * 获取报名资料     * @param profession_id     */    function getFields(profession_id) {        {if !empty($data.profession_fields_array)}        var profession_fields = [];        profession_fields = {$data.profession_fields_array};        {else}        var profession_fields = "";        {/if}        $.ajax({            type:"POST",            url:"{:url('Profession/getFields')}",            data: {profession_id : profession_id},            dataType:"json",            success:function(res){                if (res.code == 1){                    let list = res.data;                    $("#profession_fields").empty();                    var t = ``;                    for (let i=0; i < list.length; i++){                        t += `<input type="checkbox" name="profession_fields[]" `;                        let dy = $.inArray(list[i]['id']+'',profession_fields);                        if (dy >= 0){                            t += `checked=true `;                        }                        t += `value="`+list[i]['id']+`" title="`+list[i]['title']+`">`;                    }                    $("#profession_fields").append(t);                    // 添加完记得render下  否则不会刷新到页面中                    form.render('checkbox');                    form.render('radio');                }else{                    $("#profession_fields").empty();                }            },            error:function(res){                $("#profession_fields").empty();                return false;            }        });    }  });</script><script>    $(document).ready( function() {                  $('.demo').each( function() {                //                // Dear reader, it's actually very easy to initialize MiniColors. For example:                //                //  $(selector).minicolors();                //                // The way I've done it below is just for the demo, so don't get confused                 // by it. Also, data- attributes aren't supported at this time. Again,                 // they're only used for the purposes of this demo.                //        $(this).minicolors({          control: $(this).attr('data-control') || 'hue',          defaultValue: $(this).attr('data-defaultValue') || '',          inline: $(this).attr('data-inline') === 'true',          letterCase: $(this).attr('data-letterCase') || 'lowercase',          opacity: $(this).attr('data-opacity'),          position: $(this).attr('data-position') || 'bottom left',          change: function(hex, opacity) {            var log;            try {              log = hex ? hex : 'transparent';              if( opacity ) log += ', ' + opacity;              console.log(log);            } catch(e) {}          },          theme: 'default'        });                            });          });  </script>